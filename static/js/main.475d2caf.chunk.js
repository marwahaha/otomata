(this.webpackJsonpotomata=this.webpackJsonpotomata||[]).push([[0],{31:function(t,e,n){},32:function(t,e,n){},48:function(t,e,n){"use strict";n.r(e);var r=n(10),a=n(8),i=n.n(a),s=n(18),c=n.n(s),o=(n(31),n(0)),l=n(1),u=n(3),d=n(2),p=n(6),h=(n(32),n(9));function f(t){return Object(r.jsx)("td",{onClick:t.handleClick,className:"cell",children:t.val})}var j=function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(t){var r;return Object(o.a)(this,n),(r=e.call(this,t)).grid=Object(h.a)(Array(r.props.len).keys()),r}return Object(l.a)(n,[{key:"render",value:function(){var t=this;return Object(r.jsx)("tr",{children:this.grid.map((function(e){var n=t.props.offset*t.props.len+e;return Object(r.jsx)(f,{handleClick:function(n){return t.props.handleCellClick(n,e,t.props.offset)},val:t.props.vals[e]},n)}))})}}]),n}(i.a.Component);function v(t){return Object(r.jsx)("div",{})}var b=function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(){var t;Object(o.a)(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))).notImplemented=function(t){return function(){throw new Error(t+" not implemented")}},t.tick=t.notImplemented("tick"),t.load=t.notImplemented("load"),t.getURL=t.notImplemented("getURL"),t.clear=t.notImplemented("clear"),t.subrender=t.notImplemented("subrender"),t.setTimer=function(){t.timerID=setInterval((function(){return t.tick()}),t.state.interval),t.setState((function(t,e){return Object(p.a)(Object(p.a)({},t),{},{timerSet:!0})}))},t.unsetTimer=function(){clearInterval(t.timerID),t.setState((function(t,e){return Object(p.a)(Object(p.a)({},t),{},{timerSet:!1})}))},t.toggleTimer=function(){t.state.timerSet?t.unsetTimer():t.setTimer()},t.changeInterval=function(e){var r=parseInt(e.target.value,10);t.setState({interval:n.convertBpmInterval(r)})},t.changeLoadInput=function(e){t.setState({loadInput:e.target.value})},t.renderTempo=function(){return parseInt(n.convertBpmInterval(t.state.interval),10).toString()},t}return Object(l.a)(n,[{key:"componentWillUnmount",value:function(){this.unsetTimer()}},{key:"render",value:function(){return Object(r.jsxs)("div",{children:[this.subrender(),Object(r.jsxs)("div",{className:"controls",children:[Object(r.jsx)("button",{onClick:this.toggleTimer,children:this.state.timerSet?"Pause":"Play"}),Object(r.jsx)("span",{className:"spacer"}),Object(r.jsx)("button",{onClick:this.clear,children:"Clear"}),Object(r.jsx)("span",{className:"spacer"}),"Tempo:\xa0",Object(r.jsx)("input",{className:"bpm",onChange:this.changeInterval,value:this.renderTempo(),disabled:this.state.timerSet,type:"number",min:"50",max:"300",placeholder:this.renderTempo()}),Object(r.jsxs)("div",{className:"urlcontrols",children:[Object(r.jsx)("input",{placeholder:"earslap URL",onChange:this.changeLoadInput,value:this.state.loadInput,className:"loadurl"}),"\xa0",Object(r.jsx)("button",{onClick:this.load,children:"Load"}),Object(r.jsx)("span",{className:"spacer"}),Object(r.jsx)("button",{onClick:this.getURL,children:"Get URL"})]})]})]})}}],[{key:"convertBpmInterval",value:function(t){return 3e4/t}}]),n}(i.a.Component),g=n(17),O=function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(t){var a;return Object(o.a)(this,n),(a=e.call(this,t)).getURL=function(){a.unsetTimer();var t=parseInt(b.convertBpmInterval(a.state.interval),10),e="";Object.values(a.state.widgets).forEach((function(t){e+=t.pos[0].toString()+t.pos[1].toString()+t.dir.toString()})),alert("http://earslap.com/projectslab/otomata/?q=10_0_"+t+"_"+e)},a.load=function(){a.unsetTimer();var t=a.state.loadInput.indexOf("?q=");if(-1!==t){var e=a.state.loadInput.slice(t+3).split("_");if(4===e.length)return a.loadNewWay();if(1===e.length)return a.loadOldWay()}alert("could not parse URL")},a.loadOldWay=function(){a.setState((function(t,e){for(var n=a.state.loadInput.indexOf("?q="),r=t.loadInput.slice(n+3).match(/.{2}/g)||[],i=Object(p.a)(Object(p.a)({},t),{},{widgets:{},synths:{}}),s=0;s<r.length;s++){var c=parseInt(r[s][0],10),o="qwertyuiopasdfghjklzxcvbnm0123456789".indexOf(r[s][1]),l=o%4,u=parseInt((o-l)/4,10);i=a._addWidgetInternal(i,c,u,l)}return Object(p.a)(Object(p.a)({},i),{},{timerSet:!1,vals:a.updateVals(i.widgets),interval:a.DEFAULT_INTERVAL})}))},a.loadNewWay=function(){a.setState((function(t,e){for(var n=t.loadInput.indexOf("?q="),r=t.loadInput.slice(n).split("_"),i=b.convertBpmInterval(r[2]),s=r[3].match(/.{3}/g)||[],c=Object(p.a)(Object(p.a)({},t),{},{widgets:{},synths:{}}),o=0;o<s.length;o++){var l=parseInt(s[o][0],10),u=parseInt(s[o][1],10),d=parseInt(s[o][2],10);c=a._addWidgetInternal(c,l,u,d)}return Object(p.a)(Object(p.a)({},c),{},{timerSet:!1,vals:a.updateVals(c.widgets),interval:i})}))},a._generateSynth=function(){return(new g.c).connect(a.reverb).connect(a.feedback).toDestination()},a._addWidgetInternal=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=JSON.parse(JSON.stringify(t.widgets));i[t.ctr]={idx:t.ctr,pos:[e,n],dir:r};var s=Object(p.a)({},t.synths);return s[t.ctr]=a._generateSynth(),Object(p.a)(Object(p.a)({},t),{},{synths:s,widgets:i,vals:a.updateVals(i),ctr:t.ctr+1})},a.clear=function(){a.setState((function(t,e){return Object(p.a)(Object(p.a)({},t),{},{widgets:{},synths:{},vals:a.updateVals({})})}))},a.handleCellClick=function(t,e,n){a.setState((function(t,r){var i=Object.values(t.widgets).filter((function(t){return t.pos[0]===e&&t.pos[1]===n})).flat();if(0===i.length)return a._addWidgetInternal(t,e,n);if(1===i.length){var s=i[0].idx,c=JSON.parse(JSON.stringify(t.widgets)),o=c[s].dir;return o<3?c[s].dir=(o+1)%4:(delete c[s],delete t.synths[s]),Object(p.a)(Object(p.a)({},t),{},{widgets:c,vals:a.updateVals(c)})}}))},a.tick=function(){a.setState((function(t,e){var n=JSON.parse(JSON.stringify(t.widgets));return n=a.handleCollisions(n),Object.keys(n).forEach((function(t){n[t]=a.updateWidget(n[t])})),Object(p.a)(Object(p.a)({},t),{},{widgets:n,vals:a.updateVals(n)})}));var t=a.playSounds();a.highlightCells(t)},a.subrender=function(){return Object(r.jsxs)("div",{children:[Object(r.jsx)("table",{children:Object(r.jsx)("tbody",{children:a.grid.map((function(t){return Object(r.jsx)(j,{handleCellClick:a.handleCellClick,offset:t,vals:a.state.vals[t],len:a.props.gridsize},t)}))})}),Object(r.jsx)("br",{}),Object.values(a.state.widgets).map((function(t){return Object(r.jsx)(v,{idx:t.idx,dir:t.dir,pos:t.pos},t.idx)}))]})},a.grid=Object(h.a)(Array(a.props.gridsize).keys()),a.reverb=new g.b(.3).toDestination(),a.feedback=new g.a(.3,.2).toDestination(),a.DEFAULT_INTERVAL=200,a.state={widgets:{},synths:{},vals:a.initVals(),interval:a.DEFAULT_INTERVAL,ctr:0,loadInput:""},a}return Object(l.a)(n,[{key:"initVals",value:function(){var t=this;return new Array(this.props.gridsize).fill("").map((function(e){return new Array(t.props.gridsize).fill("")}))}},{key:"updateVals",value:function(t){var e=this.initVals();return Object.values(t).forEach((function(t){return e[t.pos[1]][t.pos[0]]+=n.getArrow(t.dir)})),e}},{key:"playSounds",value:function(){var t=this,e={cols:[],rows:[]};return Object.keys(this.state.widgets).forEach((function(n){var r=t.state.widgets[n],a=t.state.synths[n];t.didHitWall(r.pos,r.dir)&&(t.makeSound(r.pos,r.dir,a),r.dir%2?e.rows.push(r.pos[1]):e.cols.push(r.pos[0]))})),e}},{key:"highlightCells",value:function(t){for(var e=[],n=0;n<this.props.gridsize;n++)for(var r=0;r<this.props.gridsize;r++)-1===t.rows.indexOf(n)&&-1===t.cols.indexOf(r)||e.push(n*this.props.gridsize+r);var a=document.getElementsByClassName("cell");e.forEach((function(t){a[t].innerText||(a[t].className="cell flashing")})),setTimeout((function(){return e.forEach((function(t){a[t].innerText||(a[t].className="cell")}))}),75)}},{key:"didHitWall",value:function(t,e){var n=this.props.gridsize-1;return 0===e&&0===t[1]||1===e&&t[0]===n||2===e&&t[1]===n||3===e&&0===t[0]}},{key:"makeSound",value:function(t,e,n){var r=0,a=this.props.gridsize-1;r=e%2!==1||0!==t[0]&&t[0]!==a?t[0]:a-t[1],n.triggerAttackRelease(this.props.scale[r%this.props.scale.length],"8n",g.d(),.3)}},{key:"updateWidget",value:function(t){return this.didHitWall(t.pos,t.dir)&&(t.dir=(t.dir+2)%4),2===t.dir?t.pos=[t.pos[0],(t.pos[1]+1+this.props.gridsize)%this.props.gridsize]:0===t.dir?t.pos=[t.pos[0],(t.pos[1]-1+this.props.gridsize)%this.props.gridsize]:1===t.dir?t.pos=[(t.pos[0]+1+this.props.gridsize)%this.props.gridsize,t.pos[1]]:t.pos=[(t.pos[0]-1+this.props.gridsize)%this.props.gridsize,t.pos[1]],t}},{key:"handleCollisions",value:function(t){var e=Object.values(t).map((function(t){return[t.idx,t.pos.join(",")]})),n=Object.values(this.groupBy(e,1,0));return n.filter((function(t){return t.length>2})).flat().forEach((function(e){t[e].dir=(t[e].dir+2)%4})),n.filter((function(t){return 2===t.length})).flat().forEach((function(e){t[e].dir=(t[e].dir+1)%4})),t}},{key:"groupBy",value:function(t,e,n){return t.reduce((function(t,r){return(t[r[e]]=t[r[e]]||[]).push(r[n]),t}),{})}}],[{key:"getArrow",value:function(t){return 0===t?"\u2191":1===t?"\u2192":2===t?"\u2193":"\u2190"}}]),n}(b),m=n(19),y=function(t){Object(u.a)(n,t);var e=Object(d.a)(n);function n(){return Object(o.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(r.jsx)("div",{className:"App",children:Object(r.jsx)(O,{gridsize:9,scale:["E3","B3","C4","D4","E4","F#4","G4","B4","D5"]})})}}]),n}(a.Component),I=Object(m.b)((function(t){return Object(p.a)({},t)}))(y),x=n(14),k=n(25),w=Object(x.c)({});c.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(m.a,{store:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(x.d)(w,t,Object(x.a)(k.a))}(),children:Object(r.jsx)(I,{})})}),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.475d2caf.chunk.js.map