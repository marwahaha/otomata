(this.webpackJsonpotomata=this.webpackJsonpotomata||[]).push([[0],{31:function(e,t,n){},32:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var a=n(10),r=n(8),s=n.n(r),i=n(18),c=n.n(i),l=(n(31),n(0)),o=n(1),u=n(3),d=n(2),p=n(6),h=(n(32),n(9));function m(e){return Object(a.jsx)("td",{onClick:e.handleClick,className:"cell",children:e.val})}var f=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).grid=Object(h.a)(Array(a.props.len).keys()),a}return Object(o.a)(n,[{key:"render",value:function(){var e=this;return Object(a.jsx)("tr",{children:this.grid.map((function(t){var n=e.props.offset*e.props.len+t;return Object(a.jsx)(m,{handleClick:function(n){return e.props.handleCellClick(n,t,e.props.offset)},val:e.props.vals[t]},n)}))})}}]),n}(s.a.Component);function j(e){return Object(a.jsx)("div",{})}var v=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).notImplemented=function(e){return function(){throw new Error(e+" not implemented")}},e.tick=e.notImplemented("tick"),e.load=e.notImplemented("load"),e.getURL=e.notImplemented("getURL"),e.clear=e.notImplemented("clear"),e.subrender=e.notImplemented("subrender"),e.changeScale=function(t){e.setState((function(e,n){return Object(p.a)(Object(p.a)({},e),{},{scaleId:parseInt(t.target.value,10)})}))},e.setTimer=function(){e.timerID=setInterval((function(){return e.tick()}),e.state.interval),e.setState((function(e,t){return Object(p.a)(Object(p.a)({},e),{},{timerSet:!0})}))},e.unsetTimer=function(){clearInterval(e.timerID),e.setState((function(e,t){return Object(p.a)(Object(p.a)({},e),{},{timerSet:!1})}))},e.toggleTimer=function(){e.state.timerSet?e.unsetTimer():e.setTimer()},e.changeInterval=function(t){var a=parseInt(t.target.value,10);e.setState({interval:n.convertBpmInterval(a)})},e.changeLoadInput=function(t){e.setState({loadInput:t.target.value})},e.renderTempo=function(){return parseInt(n.convertBpmInterval(e.state.interval),10).toString()},e}return Object(o.a)(n,[{key:"componentWillUnmount",value:function(){this.unsetTimer()}},{key:"render",value:function(){return Object(a.jsxs)("div",{children:[this.subrender(),Object(a.jsxs)("div",{className:"controls",children:[Object(a.jsx)("button",{onClick:this.toggleTimer,children:this.state.timerSet?"Pause":"Play"}),Object(a.jsx)("span",{className:"spacer"}),Object(a.jsx)("button",{onClick:this.clear,children:"Clear"}),Object(a.jsx)("span",{className:"spacer"}),"Tempo:\xa0",Object(a.jsx)("input",{className:"bpm",onChange:this.changeInterval,value:this.renderTempo(),disabled:this.state.timerSet,type:"number",min:"50",max:"300",placeholder:this.renderTempo()}),Object(a.jsxs)("div",{className:"urlcontrols",children:[Object(a.jsx)("input",{placeholder:"earslap URL",onChange:this.changeLoadInput,value:this.state.loadInput,className:"loadurl"}),"\xa0",Object(a.jsx)("button",{onClick:this.load,children:"Load"}),Object(a.jsx)("span",{className:"spacer"}),Object(a.jsx)("button",{onClick:this.getURL,children:"Get URL"})]}),Object(a.jsxs)("div",{className:"scalecontrols",children:["Scale:\xa0",Object(a.jsx)("select",{name:"scale",value:this.state.scaleId.toString(),className:"scale",onChange:this.changeScale,children:n.ALL_SCALES.map((function(e,t){return Object(a.jsx)("option",{value:t,children:e.name},t)}))})]})]})]})}}],[{key:"convertBpmInterval",value:function(e){return 3e4/e}}]),n}(s.a.Component);v.ALL_SCALES=[{name:"Otomata",scale:["E3","B3","C4","D4","E4","F#4","G4","B4","D5"]},{name:"Aeolian",scale:["E3","A3","B3","C4","D4","E4","F4","G4","A4"]},{name:"Ake Bono",scale:["E3","A3","B3","C4","E4","F4","A4","B4","C5"]},{name:"Yue-Diao",scale:["E3","B3","D4","E4","G4","A4","B4","D5","E5"]},{name:"Bayati",scale:["E3","A3","B3","C4","D4","E4","F4","G4","A4"]},{name:"Dorian",scale:["E3","A3","B3","C4","D4","E4","F#4","G4","A4"]},{name:"Harmonic minor",scale:["E3","A3","B3","C4","D4","E4","F4","G#4","A4"]},{name:"Hijaz",scale:["E3","A3","A#3","C#4","D4","E4","F4","G4","A4"]},{name:"Hijaz kar",scale:["E3","A3","A#3","C#4","D4","E4","F4","G#4","A4"]},{name:"Huzam",scale:["E3","A3","C4","C#4","D4","E4","F#4","G#4","A4"]},{name:"Ionian",scale:["E3","A3","B3","C#4","D4","E4","F#4","G#4","A4"]},{name:"Kokin-Choshi",scale:["E3","A3","A#3","D4","E4","G4","A4","A#4","D5"]},{name:"Kourd-Atar",scale:["E3","A3","A#3","C4","D#4","E4","F4","G#4","A4"]},{name:"Lydian",scale:["E3","A3","B3","C#4","D#4","E4","F#4","G#4","A4"]},{name:"Yu-Diao",scale:["E3","A3","C4","D4","E4","G4","A4","C5","D5"]},{name:"Neveseri",scale:["E3","A3","A#3","C4","C#4","E4","F4","G4","G#4"]},{name:"Niavent",scale:["E3","A3","B3","C4","D#4","E4","F4","G#4","A4"]},{name:"Nirz Rast",scale:["E3","A3","B3","C#4","D4","E4","F#4","G4","A4"]},{name:"Gong-Diao",scale:["E3","A3","B3","C#4","E4","F#4","A4","B4","C#5"]},{name:"Zhi-Diao",scale:["E3","B3","D4","E4","F#4","G#4","B4","C#5","E5"]},{name:"Purvi",scale:["E3","A3","A#3","C#4","D#4","E4","F4","G#4","A4"]},{name:"Pygmy",scale:["E3","A3","B3","C4","E4","G4","A4","B4","C5"]},{name:"Rast",scale:["E3","A3","B3","C#4","D4","E4","F#4","G#4","A4"]},{name:"Rumanikos",scale:["E3","A3","B3","C4","D#4","E4","F#4","G4","A4"]},{name:"Sabah",scale:["E3","A3","B3","C4","C#4","E4","F4","G4","G#4"]},{name:"Segiah",scale:["E3","A3","C4","C#4","D4","E4","F4","G#4","A4"]},{name:"Sho",scale:["E3","A3","B3","C4","D4","E4","F#4","A4","B4"]},{name:"Blues",scale:["E3","A3","C4","D4","D#4","E4","G4","A4","C5"]},{name:"Goonkali",scale:["E3","A3","A#3","D4","E4","F#4","A4","A#4","D5"]},{name:"Iwato",scale:["E3","B3","C4","E4","F4","A4","B4","C5","E5"]},{name:"Kumoi",scale:["E3","A3","B3","C4","E4","F#4","A4","B4","C5"]},{name:"Locrian",scale:["E3","B3","C4","D4","E4","F4","G4","A4","B4"]},{name:"Magen Abot",scale:["E3","G#3","A3","B3","C4","D4","E4","G4","G#4"]},{name:"Melog",scale:["E3","G#3","A3","B3","D#4","E4","G#4","A4","B4"]},{name:"Mixolydian",scale:["E3","A3","B3","C#4","D4","E4","F#4","G4","A4"]},{name:"Noh",scale:["E3","A3","B3","D4","E4","F4","F#4","G#4","A4"]},{name:"Phrygian",scale:["E3","A3","A#3","C4","D4","E4","F4","G4","A4"]},{name:"Pyeong Jo",scale:["E3","B3","C#4","E4","G#4","A4","B4","C#5","E5"]},{name:"Shang-Diao",scale:["E3","A3","B3","D4","E4","G4","A4","B4","D5"]},{name:"Zokuso",scale:["E3","B3","C4","E4","F4","G4","B4","C5","E5"]}];var g=n(17),b=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(l.a)(this,n),(r=t.call(this,e)).getURL=function(){r.unsetTimer();var e=parseInt(v.convertBpmInterval(r.state.interval),10),t="";Object.values(r.state.widgets).forEach((function(e){t+=e.pos[0].toString()+e.pos[1].toString()+e.dir.toString()})),alert("https://marwahaha.github.io/otomata/?q=10_"+r.state.scaleId+"_"+e+"_"+t)},r.load=function(){r.unsetTimer();var e=r.state.loadInput.indexOf("?q=");if(-1!==e){var t=r.state.loadInput.slice(e+3).split("_");if(4===t.length)return r.loadNewWay();if(1===t.length)return r.loadOldWay()}alert("could not parse URL")},r.loadOldWay=function(){r.setState((function(e,t){for(var n=r.state.loadInput.indexOf("?q="),a=e.loadInput.slice(n+3).match(/.{2}/g)||[],s=Object(p.a)(Object(p.a)({},e),{},{widgets:{},synths:{}}),i=0;i<a.length;i++){var c=parseInt(a[i][0],10),l="qwertyuiopasdfghjklzxcvbnm0123456789".indexOf(a[i][1]),o=l%4,u=parseInt((l-o)/4,10);s=r._addWidgetInternal(s,c,u,o)}return Object(p.a)(Object(p.a)({},s),{},{scaleId:0,timerSet:!1,vals:r.updateVals(s.widgets),interval:r.DEFAULT_INTERVAL})}))},r.loadNewWay=function(){r.setState((function(e,t){for(var n=e.loadInput.indexOf("?q="),a=e.loadInput.slice(n).split("_"),s=parseInt(a[1],10),i=v.convertBpmInterval(a[2]),c=a[3].match(/.{3}/g)||[],l=Object(p.a)(Object(p.a)({},e),{},{widgets:{},synths:{}}),o=0;o<c.length;o++){var u=parseInt(c[o][0],10),d=parseInt(c[o][1],10),h=parseInt(c[o][2],10);l=r._addWidgetInternal(l,u,d,h)}return Object(p.a)(Object(p.a)({},l),{},{scaleId:s,timerSet:!1,vals:r.updateVals(l.widgets),interval:i})}))},r._generateSynth=function(){return(new g.c).connect(r.reverb).connect(r.feedback).toDestination()},r._addWidgetInternal=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=JSON.parse(JSON.stringify(e.widgets));s[e.ctr]={idx:e.ctr,pos:[t,n],dir:a};var i=Object(p.a)({},e.synths);return i[e.ctr]=r._generateSynth(),Object(p.a)(Object(p.a)({},e),{},{synths:i,widgets:s,vals:r.updateVals(s),ctr:e.ctr+1})},r.clear=function(){r.setState((function(e,t){return Object(p.a)(Object(p.a)({},e),{},{widgets:{},synths:{},vals:r.updateVals({})})}))},r.handleCellClick=function(e,t,n){r.setState((function(e,a){var s=Object.values(e.widgets).filter((function(e){return e.pos[0]===t&&e.pos[1]===n})).flat();if(0===s.length)return r._addWidgetInternal(e,t,n);if(1===s.length){var i=s[0].idx,c=JSON.parse(JSON.stringify(e.widgets)),l=c[i].dir;return l<3?c[i].dir=(l+1)%4:(delete c[i],delete e.synths[i]),Object(p.a)(Object(p.a)({},e),{},{widgets:c,vals:r.updateVals(c)})}}))},r.tick=function(){r.setState((function(e,t){var n=JSON.parse(JSON.stringify(e.widgets));return n=r.handleCollisions(n),Object.keys(n).forEach((function(e){n[e]=r.updateWidget(n[e])})),Object(p.a)(Object(p.a)({},e),{},{widgets:n,vals:r.updateVals(n)})}));var e=r.playSounds();r.highlightCells(e)},r.subrender=function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)("table",{children:Object(a.jsx)("tbody",{children:r.grid.map((function(e){return Object(a.jsx)(f,{handleCellClick:r.handleCellClick,offset:e,vals:r.state.vals[e],len:r.props.gridsize},e)}))})}),Object(a.jsx)("br",{}),Object.values(r.state.widgets).map((function(e){return Object(a.jsx)(j,{idx:e.idx,dir:e.dir,pos:e.pos},e.idx)}))]})},r.grid=Object(h.a)(Array(r.props.gridsize).keys()),r.reverb=new g.b(.3).toDestination(),r.feedback=new g.a(.3,.2).toDestination(),r.DEFAULT_INTERVAL=200,r.state={widgets:{},synths:{},vals:r.initVals(),interval:r.DEFAULT_INTERVAL,ctr:0,loadInput:window.location.search,scaleId:0},r}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.state.loadInput&&this.load()}},{key:"initVals",value:function(){var e=this;return new Array(this.props.gridsize).fill("").map((function(t){return new Array(e.props.gridsize).fill("")}))}},{key:"updateVals",value:function(e){var t=this.initVals();return Object.values(e).forEach((function(e){return t[e.pos[1]][e.pos[0]]+=n.getArrow(e.dir)})),t}},{key:"playSounds",value:function(){var e=this,t={cols:[],rows:[]};return Object.keys(this.state.widgets).forEach((function(n){var a=e.state.widgets[n],r=e.state.synths[n];e.didHitWall(a.pos,a.dir)&&(e.makeSound(a.pos,a.dir,r),a.dir%2?t.rows.push(a.pos[1]):t.cols.push(a.pos[0]))})),t}},{key:"highlightCells",value:function(e){for(var t=[],n=0;n<this.props.gridsize;n++)for(var a=0;a<this.props.gridsize;a++)-1===e.rows.indexOf(n)&&-1===e.cols.indexOf(a)||t.push(n*this.props.gridsize+a);var r=document.getElementsByClassName("cell");t.forEach((function(e){r[e].innerText||(r[e].className="cell flashing")})),setTimeout((function(){return t.forEach((function(e){r[e].innerText||(r[e].className="cell")}))}),50)}},{key:"didHitWall",value:function(e,t){var n=this.props.gridsize-1;return 0===t&&0===e[1]||1===t&&e[0]===n||2===t&&e[1]===n||3===t&&0===e[0]}},{key:"makeSound",value:function(e,t,n){var a=0,r=this.props.gridsize-1;a=t%2!==1||0!==e[0]&&e[0]!==r?e[0]:r-e[1];var s=v.ALL_SCALES[this.state.scaleId].scale;n.triggerAttackRelease(s[a%s.length],"8n",g.d(),.3)}},{key:"updateWidget",value:function(e){return this.didHitWall(e.pos,e.dir)&&(e.dir=(e.dir+2)%4),2===e.dir?e.pos=[e.pos[0],(e.pos[1]+1+this.props.gridsize)%this.props.gridsize]:0===e.dir?e.pos=[e.pos[0],(e.pos[1]-1+this.props.gridsize)%this.props.gridsize]:1===e.dir?e.pos=[(e.pos[0]+1+this.props.gridsize)%this.props.gridsize,e.pos[1]]:e.pos=[(e.pos[0]-1+this.props.gridsize)%this.props.gridsize,e.pos[1]],e}},{key:"handleCollisions",value:function(e){var t=Object.values(e).map((function(e){return[e.idx,e.pos.join(",")]})),n=Object.values(this.groupBy(t,1,0));return n.filter((function(e){return e.length>2})).flat().forEach((function(t){e[t].dir=(e[t].dir+2)%4})),n.filter((function(e){return 2===e.length})).flat().forEach((function(t){e[t].dir=(e[t].dir+1)%4})),e}},{key:"groupBy",value:function(e,t,n){return e.reduce((function(e,a){return(e[a[t]]=e[a[t]]||[]).push(a[n]),e}),{})}}],[{key:"getArrow",value:function(e){return 0===e?"\u2191":1===e?"\u2192":2===e?"\u2193":"\u2190"}}]),n}(v),E=n(19),A=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return Object(a.jsx)("div",{className:"App",children:Object(a.jsx)(b,{gridsize:9})})}}]),n}(r.Component),O=Object(E.b)((function(e){return Object(p.a)({},e)}))(A),C=n(14),y=n(25),I=Object(C.c)({});c.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(E.a,{store:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(C.d)(I,e,Object(C.a)(y.a))}(),children:Object(a.jsx)(O,{})})}),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.e6f95dc5.chunk.js.map